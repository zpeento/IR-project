<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
	<form name = "form1" enctype="multipart/form-data">
		<!-- <input type="file" name="file1" onchange="javascript:jsReadFiles()"> -->
		jsReadFile:<input type="file" onchange="jsReadFiles(this.files)"/>
	</form>


  <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>  
    <script Language="JavaScript">
	//js 读取文件
	var str = ''
    //js 读取文件
    function jsReadFiles(files) {
        if (files.length) {
            var file = files[0];
            var reader = new FileReader();//new一个FileReader实例
            if (/text+/.test(file.type)) {//判断文件类型，是不是text类型
                reader.onload = function() {
                    $('body').append('<pre>' + this.result + '</pre>');
                    var str = this.result;
                    clauses(str)
                }
                reader.readAsText(file);
            } else if(/image+/.test(file.type)) {//判断文件是不是imgage类型
                reader.onload = function() {
                    $('body').append('<img src="' + this.result + '"/>');
                }
                reader.readAsDataURL(file);
            }
        }
    }

    function clauses (str) {
        // var reg = /.{0,30}\n[.\n]*?\n.?$/
//         console.log(arr[1])
//         var aaa = arr[1].split(/\n/g)
//         console.log(aaa)
//         var m = ''
//         for(var j = aaa.length - 1 ; j > 0 ; j--){
//                     console.log(aaa[j])
//                     m = aaa[j]+m
//         }
        
// console.log('m= '+m)

        //将文章按终止标点符号粗略划分成句子
    	var arr = str.split(/[。！？]/g);
    	
        //对每一个未加工的句子进行加工
    	var arr_processed = arr.map(function(item){

            //将句子按换行符划分成行，保存在数组中
    		var item_processed = item.split(/\n/g);

    		var sentence = ''

            //当该句子的行数大于一时，说明该句子占据多行
    		if(item_processed.length>1){
    			
                //获取最后一行（即连接句号的那一行）的下标
    			var last_index = item_processed.length - 1

                //result_sentence数组用于存放合适的行
    			var result_sentence = [item_processed[last_index]]

                //对句子的除最后一行外的每一行，以从下往上的顺序进行循环
	    		for(var i = item_processed.length-2 ; i > -1 ; i--){

                    //当遍历到出现有一行的字符数小于特定的长度时，可以判定该行以及该行往上的文本都不是句子的部分。
	    			if(item_processed[i].length < 30){
	    				break
	    			}

                    //将通过判定的行添加到数组前面
	    			result_sentence.unshift(item_processed[i]);
	    		}

                //数组拼接即得到完整的句子
	    		sentence = result_sentence.join('')
    		}else if(item_processed.length == 1){
                //当句子只占据一行时
                sentence = item_processed[0]
            }else{
                alert('wtf')
            }
    		return sentence
    	})
    	// var arr1 = str.split(/[\n]/g);
    	console.log(arr_processed)
    }


</script>  
</body>
</html>